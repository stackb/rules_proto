#!/bin/bash

set -ueo pipefail

cd $BUILD_WORKING_DIRECTORY

# The path to the text file you want to modify
file_path="go.mod"

# The new content you want to insert between the markers
new_content="
{content}
"

# Use sed to replace the content between the simplified markers
sed -i "/BEGIN: generated by: bazel run/,/END: generated by: bazel run/{
    /BEGIN: generated by: bazel run/!d
    r /dev/stdin
    d
}" "$file_path" <<< "$new_content"

echo "$file_path updated successfully!"

echo "Cleaning up with 'go mod tidy'..."

go mod tidy
